Port to typescript (not sure if ready)